
# 重構技巧補充報告 (Refactoring Supplement Report)

## 1. 變數與邏輯處理 (Variables & Logic)

針對程式碼中的變數使用與運算式邏輯，以下技巧旨在提高程式碼的可讀性與職責的清晰度。

### 1.1 提煉變數 (Extract Variable)
*   **適用情境**：當你遇到一個難以理解的複雜運算式時。
*   **操作方式**：將該運算式的結果或其組成部分，放入名稱具有自我解釋性（self-explanatory）的獨立變數中。
*   **目的**：透過變數名稱來說明運算式背後的業務邏輯，使程式碼像自然語言一樣易讀。
    *   *範例*：將複雜的 `if` 判斷式（包含平台字串檢查、瀏覽器檢查等）拆解為 `isMacOs`、`isIE` 等 boolean 變數，最後在 `if` 中僅需檢查這些變數。

### 1.2 內聯臨時變數 (Inline Temp)
*   **適用情境**：當你有一個臨時變數，它僅僅是被賦值為一個簡單運算式的結果，且除此之外沒有做其他事情。
*   **操作方式**：將所有對該變數的引用（references），直接替換為該運算式本身。
*   **目的**：減少不必要的變數干擾，通常這也是為了後續進行「提煉方法（Extract Method）」做準備。

### 1.3 分解臨時變數 (Split Temporary Variable)
*   **適用情境**：當有一個區域變數（local variable）在一個方法內被用來儲存多個不同的中間值（即同一個變數被重複賦值用於完全不同的目的）。
*   **操作方式**：針對每一個不同的數值，使用不同的變數名稱。
*   **目的**：變數應當只承擔單一職責。若一個變數 `temp` 先被用來算周長，後來又被用來算面積，會讓人混淆該變數的定義。應拆分為 `perimeter` 與 `area` 兩個變數。

---

## 2. 方法與類別結構 (Methods & Classes)

針對類別的職責分配與資料結構的封裝，以下技巧有助於簡化架構。

### 2.1 內聯方法 (Inline Method)
*   **適用情境**：當一個方法的「內容（body）」比該方法的「名稱」還要顯而易見時。
*   **操作方式**：將呼叫該方法的地方，直接替換為該方法的內容，並刪除該方法。
*   **目的**：去除過度委派（indirection）。如果一個方法只是單純回傳一個簡單比較（例如 `return numberOfLateDeliveries > 5`），直接使用比較式可能比呼叫一個額外的方法更直觀。

### 2.2 內聯類別 (Inline Class)
*   **適用情境**：當一個類別幾乎沒有做任何事情，不負責任，且未來也沒有規劃給它額外的職責。
*   **操作方式**：將該類別的所有功能（特性）搬移到另一個類別中。
*   **目的**：消除無用的類別。
    *   *範例*：若 `TelephoneNumber` 類別只包含區碼與號碼且無其他邏輯，可將其屬性與方法併回 `Person` 類別中。

### 2.3 以物件取代陣列 (Replace Array with Object)
*   **適用情境**：當你有一個陣列，裡面包含了各種類型或意義不同的資料（例如：索引0是名字，索引1是勝場數）。
*   **操作方式**：將該陣列替換為一個物件，並為每個元素設立獨立的欄位（Field）。
*   **目的**：陣列應該只用於儲存相似的物件。若用於儲存結構化資料，使用物件（如 `Performance` 類別）並透過 `setName` 或 `setWins` 來存取，會比操作 `row` 或 `row` 更具可讀性與維護性。

### 2.4 複製被監視資料 (Duplicate Observed Data)
*   **適用情境**：當領域資料（domain data）被儲存在負責 GUI（圖形使用者介面）的類別中。
*   **操作方式**：將資料分離到獨立的領域類別中。
*   **目的**：實現 MVC（Model-View-Controller）模式的分離，確保業務邏輯與介面顯示解耦。
    *   *範例*：將 `IntervalWindow`（GUI）中的計算邏輯與資料，拆分出一個 `Interval` 類別來專門處理資料。

---

## 3. 條件判斷優化 (Conditional Logic)

針對複雜的控制流程，以下技巧能簡化邏輯分支。

### 3.1 分解條件式 (Decompose Conditional)
*   **適用情境**：當你有一個複雜的條件判斷（if-then/else 或 switch）。
*   **操作方式**：將條件式中複雜的部分拆解為獨立的方法：分別針對「條件判斷（condition）」、「成立時執行的部分（then）」與「不成立時執行的部分（else）」進行提煉。
*   **目的**：讓主流程清楚地表達意圖，而非細節。
    *   *範例*：將 `if (date.before(SUMMER_START) || date.after(SUMMER_END))` 這樣的複雜判斷，重構為 `if (isSummer(date))`，並將計算邏輯封裝為 `summerCharge(quantity)`。

### 3.2 合併重複的條件片段 (Consolidate Duplicate Conditional Fragments)
*   **適用情境**：在條件判斷的所有分支（branches）中，都能找到相同的程式碼。
*   **操作方式**：將這段重複的程式碼搬移到條件判斷式之外。
*   **目的**：避免重複程式碼（DRY原則）。
    *   *範例*：如果在 `if` 區塊與 `else` 區塊的最後都呼叫了 `send()`，應將 `send()` 移至整個 `if-else` 結構的後方執行一次即可。

---

### 總結
這份教材補充了標準重構書目中關於變數管理、類別職責整併以及條件邏輯簡化的具體操作手法。透過這些技巧，開發者可以將雜亂的程式碼（如過度使用的陣列、複雜的 if-else、職責不清的變數）轉化為語意清晰、結構分明的設計。

> **比喻說明**：
> 想像你在整理廚房（程式碼）：
> *   **Extract Variable** 就像是把混合好的調味料貼上標籤「特製烤肉醬」，而不是每次都要重新確認裡面加了什麼。
> *   **Split Temporary Variable** 就像是不要用同一個髒碗先裝生肉、洗一洗再裝沙拉，應該拿兩個乾淨的碗分開裝。
> *   **Inline Method** 就像是如果「切蘋果」這個動作只有一刀，你不需要特地寫一張標準作業程序貼在牆上，直接切下去就好。